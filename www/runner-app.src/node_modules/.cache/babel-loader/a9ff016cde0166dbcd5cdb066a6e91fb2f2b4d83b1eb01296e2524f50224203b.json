{"ast":null,"code":"import _regeneratorRuntime from\"C:/Projects/[Web]/[WS2024]/3-[D\\xF6nt\\u0151]/www/runner-app.src/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Projects/[Web]/[WS2024]/3-[D\\xF6nt\\u0151]/www/runner-app.src/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Projects/[Web]/[WS2024]/3-[D\\xF6nt\\u0151]/www/runner-app.src/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import axios from\"axios\";import React from\"react\";import{useEffect,useState}from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";var DataContext=/*#__PURE__*/React.createContext({});var DataProvider=function DataProvider(_ref){var children=_ref.children;var _useState=useState(),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),currentState=_useState4[0],setCurrentState=_useState4[1];var _useState5=useState(-1),_useState6=_slicedToArray(_useState5,2),timeUntilEvent=_useState6[0],setTimeUntilEvent=_useState6[1];var checkToken=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var params,token,res;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:params=new URLSearchParams(document.location.search);token=params.get(\"token\")||localStorage.getItem(\"token\");if(token){_context.next=5;break;}setUser(null);return _context.abrupt(\"return\");case 5:_context.prev=5;_context.next=8;return axios.post(\"/api/v1/login\",{token:token});case 8:_context.next=15;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](5);localStorage.removeItem(\"token\");setUser(null);return _context.abrupt(\"return\");case 15:localStorage.setItem(\"token\",token);_context.prev=16;_context.next=19;return axios.get(\"/api/v1/me\",{headers:{Authorization:\"Bearer \"+token}});case 19:res=_context.sent;setUser(res.data);_context.next=27;break;case 23:_context.prev=23;_context.t1=_context[\"catch\"](16);alert(\"Unknown error occured.\");window.location.reload();case 27:case\"end\":return _context.stop();}},_callee,null,[[5,10],[16,23]]);}));return function checkToken(){return _ref2.apply(this,arguments);};}();var checkCurrentState=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var params,fakeDate,currentDate,startDate,diffTime,currentYear,currentMonth,currentDay,startYear,startMonth,startDay;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:params=new URLSearchParams(window.location.search);fakeDate=params.get(\"fakeDate\");currentDate=fakeDate?new Date(fakeDate):new Date();startDate=new Date((user===null||user===void 0?void 0:user.team.plannedStartingTime)||\"\");diffTime=Math.abs(Number(startDate)-Number(currentDate));setTimeUntilEvent(diffTime);if(!(currentDate<startDate)){_context2.next=9;break;}setCurrentState(\"beforeStart\");return _context2.abrupt(\"return\");case 9:currentYear=currentDate.getFullYear();currentMonth=currentDate.getMonth();currentDay=currentDate.getDate();startYear=startDate.getFullYear();startMonth=startDate.getMonth();startDay=startDate.getDate();if(currentYear===startYear&&currentMonth===startMonth&&currentDay===startDay){if((user===null||user===void 0?void 0:user.team.startingTime)===null){setCurrentState(\"beforeRace\");}else{setCurrentState(\"afterStart\");}}case 16:case\"end\":return _context2.stop();}},_callee2);}));return function checkCurrentState(){return _ref3.apply(this,arguments);};}();React.useEffect(function(){if(user){checkCurrentState();}},[user]);useEffect(function(){checkToken();},[]);return/*#__PURE__*/_jsx(DataContext.Provider,{value:{user:user,currentState:currentState,timeUntilEvent:timeUntilEvent},children:children});};export default DataContext;export{DataProvider};","map":{"version":3,"names":["axios","React","useEffect","useState","jsx","_jsx","DataContext","createContext","DataProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","currentState","setCurrentState","_useState5","_useState6","timeUntilEvent","setTimeUntilEvent","checkToken","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","params","token","res","wrap","_callee$","_context","prev","next","URLSearchParams","document","location","search","get","localStorage","getItem","abrupt","post","t0","removeItem","setItem","headers","Authorization","sent","data","t1","alert","window","reload","stop","apply","arguments","checkCurrentState","_ref3","_callee2","fakeDate","currentDate","startDate","diffTime","currentYear","currentMonth","currentDay","startYear","startMonth","startDay","_callee2$","_context2","Date","team","plannedStartingTime","Math","abs","Number","getFullYear","getMonth","getDate","startingTime","Provider","value"],"sources":["C:/Projects/[Web]/[WS2024]/3-[Döntő]/www/runner-app.src/src/common/providers/DataProvider.tsx"],"sourcesContent":["import axios from \"axios\";\r\nimport React from \"react\";\r\nimport { ReactNode, useEffect, useState } from \"react\";\r\n\r\ntype Team = {\r\n  id: number;\r\n  name: string;\r\n  contactEmail: string;\r\n  location: string;\r\n  plannedStartingTime: string;\r\n  startingTime: string | null;\r\n};\r\n\r\ntype User = {\r\n  id: number;\r\n  firstName: string;\r\n  lastName: string;\r\n  speed: string;\r\n  token: string;\r\n  isAdmin: boolean;\r\n  teamId: number;\r\n  team: Team;\r\n};\r\n\r\ntype State = \"beforeRace\" | \"beforeStart\" | \"afterStart\";\r\n\r\ntype DataContextType = {\r\n  user: User | null | undefined;\r\n  currentState: State | null;\r\n  timeUntilEvent: number;\r\n};\r\n\r\nconst DataContext = React.createContext<DataContextType>({} as DataContextType);\r\n\r\nconst DataProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\r\n  const [user, setUser] = useState<User | null | undefined>();\r\n  const [currentState, setCurrentState] = useState<State | null>(null);\r\n  const [timeUntilEvent, setTimeUntilEvent] = useState<number>(-1);\r\n\r\n  const checkToken = async () => {\r\n    const params = new URLSearchParams(document.location.search);\r\n    const token = params.get(\"token\") || localStorage.getItem(\"token\");\r\n    if (!token) {\r\n      setUser(null);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await axios.post(\"/api/v1/login\", { token });\r\n    } catch (err) {\r\n      localStorage.removeItem(\"token\");\r\n      setUser(null);\r\n      return;\r\n    }\r\n\r\n    localStorage.setItem(\"token\", token);\r\n\r\n    try {\r\n      const res = await axios.get(\"/api/v1/me\", {\r\n        headers: { Authorization: \"Bearer \" + token },\r\n      });\r\n      setUser(res.data);\r\n    } catch (err) {\r\n      alert(\"Unknown error occured.\");\r\n      window.location.reload();\r\n    }\r\n  };\r\n\r\n  const checkCurrentState = async () => {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const fakeDate = params.get(\"fakeDate\");\r\n    const currentDate = fakeDate ? new Date(fakeDate) : new Date();\r\n    const startDate = new Date(user?.team.plannedStartingTime || \"\");\r\n\r\n    const diffTime = Math.abs(Number(startDate) - Number(currentDate));\r\n    setTimeUntilEvent(diffTime);\r\n\r\n    if (currentDate < startDate) {\r\n      setCurrentState(\"beforeStart\");\r\n      return;\r\n    }\r\n\r\n    const currentYear = currentDate.getFullYear();\r\n    const currentMonth = currentDate.getMonth();\r\n    const currentDay = currentDate.getDate();\r\n    const startYear = startDate.getFullYear();\r\n    const startMonth = startDate.getMonth();\r\n    const startDay = startDate.getDate();\r\n\r\n    if (\r\n      currentYear === startYear &&\r\n      currentMonth === startMonth &&\r\n      currentDay === startDay\r\n    ) {\r\n      if (user?.team.startingTime === null) {\r\n        setCurrentState(\"beforeRace\");\r\n      } else {\r\n        setCurrentState(\"afterStart\");\r\n      }\r\n    }\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (user) {\r\n      checkCurrentState();\r\n    }\r\n  }, [user]);\r\n\r\n  useEffect(() => {\r\n    checkToken();\r\n  }, []);\r\n\r\n  return (\r\n    <DataContext.Provider value={{ user, currentState, timeUntilEvent }}>\r\n      {children}\r\n    </DataContext.Provider>\r\n  );\r\n};\r\n\r\nexport default DataContext;\r\n\r\nexport { DataProvider };\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}